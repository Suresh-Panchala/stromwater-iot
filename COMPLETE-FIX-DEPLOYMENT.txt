================================================================================
âœ… COMPLETE FIX - Alerts & Analytics Pages
================================================================================

ALL ISSUES FIXED:
âœ… Alerts page: "Failed to load alerts" - Fixed data handling
âœ… Analytics page: "TypeError: v.reduce is not a function" - Fixed data validation
âœ… 500 Internal Server Error - Will be fixed by creating alerts table
âœ… Robust error handling for both pages
âœ… Code pushed to GitHub

================================================================================
ðŸš€ DEPLOYMENT TO VPS (Run via AWS Console)
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 1: Create Alerts Table in Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Copy and paste this ENTIRE block:

sudo -u postgres psql -d stromwater_db << 'EOF'

-- Create alerts table
CREATE TABLE IF NOT EXISTS alerts (
  id SERIAL PRIMARY KEY,
  device_id VARCHAR(100) NOT NULL,
  alert_type VARCHAR(50) NOT NULL,
  alert_message TEXT,
  severity VARCHAR(20) DEFAULT 'warning',
  timestamp TIMESTAMP NOT NULL,
  acknowledged BOOLEAN DEFAULT false,
  acknowledged_by INTEGER REFERENCES users(id),
  acknowledged_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes for performance
CREATE INDEX IF NOT EXISTS idx_alerts_device_id ON alerts(device_id);
CREATE INDEX IF NOT EXISTS idx_alerts_timestamp ON alerts(timestamp DESC);
CREATE INDEX IF NOT EXISTS idx_alerts_acknowledged ON alerts(acknowledged);

-- Insert 3 sample alerts for testing
INSERT INTO alerts (device_id, alert_type, alert_message, severity, timestamp, acknowledged)
VALUES
  ('StromWater_Device_1', 'High Level Alert', 'Water level exceeded threshold', 'warning', NOW() - INTERVAL '2 hours', false),
  ('StromWater_Device_1', 'Pump Protection', 'Pump 1 protection triggered', 'critical', NOW() - INTERVAL '1 hour', false),
  ('StromWater_Device_2', 'Dry Run Alert', 'Dry run condition detected', 'warning', NOW() - INTERVAL '30 minutes', false);

-- Grant permissions to application user
GRANT ALL PRIVILEGES ON TABLE alerts TO stromwater_user;
GRANT USAGE, SELECT ON SEQUENCE alerts_id_seq TO stromwater_user;

-- Verify creation
\echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
\echo 'âœ… SUCCESS: Alerts table created!'
\echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
SELECT COUNT(*) as total_alerts FROM alerts;

EOF

âœ… Expected output: "total_alerts | 3"


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 2: Add Test Data for Analytics Page (OPTIONAL but recommended)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This adds 100 sample device readings for the Analytics page to show data:

sudo -u postgres psql -d stromwater_db << 'EOF'

-- Check current count
SELECT COUNT(*) as current_device_data FROM device_data;

-- Add 100 realistic test records spread over last 7 days
INSERT INTO device_data (
  device_id,
  hydrostatic_value,
  vrms_1_r, vrms_1_y, vrms_1_b,
  irms_1_r, irms_1_y, irms_1_b,
  vrms_2_r, vrms_2_y, vrms_2_b,
  irms_2_r, irms_2_y, irms_2_b,
  timestamp
)
SELECT
  'StromWater_Device_' || (CASE WHEN random() < 0.5 THEN '1' ELSE '2' END),
  (random() * 10 + 5)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 50 + 400)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  (random() * 20 + 20)::numeric(10,2),
  NOW() - (random() * INTERVAL '7 days')
FROM generate_series(1, 100);

-- Verify
\echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
\echo 'âœ… SUCCESS: Test data added!'
\echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
SELECT COUNT(*) as total_device_data FROM device_data;

EOF

âœ… Expected output: Shows increased count (e.g., 102 if you had 2 before)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 3: Fix Database Permissions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

sudo -u postgres psql -d stromwater_db << 'EOF'

-- Grant all necessary permissions
GRANT ALL PRIVILEGES ON DATABASE stromwater_db TO stromwater_user;
GRANT ALL ON SCHEMA public TO stromwater_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO stromwater_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO stromwater_user;

\echo 'âœ… Permissions updated successfully!'

EOF


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 4: Pull Latest Code from GitHub
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

cd /var/www/stromwater
git pull origin main

âœ… You should see:
   - "frontend/src/pages/Alerts.jsx" (modified)
   - "frontend/src/pages/Analytics.jsx" (modified)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 5: Rebuild Frontend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

cd /var/www/stromwater/frontend
npm run build

âœ… Wait for build to complete (shows "âœ“ built in X.XXs")


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 6: Restart All Services
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

pm2 restart all
pm2 save

âœ… Check status:
pm2 status

âœ… Both should show "online" status:
   - stromwater-backend (online)
   - stromwater-frontend (online)


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 7: Verify Deployment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Check database
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Database Verification:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
sudo -u postgres psql -d stromwater_db -c "SELECT COUNT(*) as alerts FROM alerts;"
sudo -u postgres psql -d stromwater_db -c "SELECT COUNT(*) as device_data FROM device_data;"

# Check backend logs (should show no errors)
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Backend Logs (last 20 lines):"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
pm2 logs stromwater-backend --lines 20 --nostream


================================================================================
ðŸ§ª TEST IN BROWSER
================================================================================

1ï¸âƒ£  ALERTS PAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   URL: http://43.205.194.142/alerts

   âœ… Should show:
      â€¢ Total Alerts: 3
      â€¢ Unacknowledged: 3
      â€¢ Acknowledged: 0
      â€¢ 3 alert cards with details
      â€¢ "Acknowledge" button on each alert
      â€¢ Filter dropdown works

   âŒ If still showing error:
      â€¢ Open browser console (F12)
      â€¢ Check for red error messages
      â€¢ Send error to Claude


2ï¸âƒ£  ANALYTICS PAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   URL: http://43.205.194.142/analytics

   âœ… Should show:
      â€¢ Device selector (Dubai/Sharjah pump stations)
      â€¢ Total Readings: 100+ (if you added test data)
      â€¢ Avg Water Level: X.XX m
      â€¢ Avg Voltage: XXX V
      â€¢ Avg Current: XX A
      â€¢ Pump 1 & Pump 2 Uptime bars
      â€¢ Date range filter (24h/7days/30days)

   âŒ If showing "No data available":
      â€¢ This is normal if device_data table is empty
      â€¢ Either add test data (Step 2) or run MQTT simulator

   âŒ If showing error:
      â€¢ Open browser console (F12)
      â€¢ Check for red error messages


3ï¸âƒ£  NAVIGATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ… Sidebar should show (in order):
      â€¢ Dashboard
      â€¢ Alerts
      â€¢ Analytics  â† NEW!
      â€¢ Users (if admin)
      â€¢ Settings


================================================================================
ðŸ“Š WHAT WAS FIXED
================================================================================

âœ… Alerts Page (frontend/src/pages/Alerts.jsx):
   â€¢ Added data format validation
   â€¢ Handles API returning object instead of array
   â€¢ Added console warnings for debugging
   â€¢ Sets empty array on errors to prevent crashes
   â€¢ Gracefully handles all response formats

âœ… Analytics Page (frontend/src/pages/Analytics.jsx):
   â€¢ Added robust data type checking
   â€¢ Handles API returning object instead of array
   â€¢ Added array validation before using .reduce()
   â€¢ Prevents "TypeError: v.reduce is not a function"
   â€¢ Shows empty state when no data available

âœ… Database:
   â€¢ Created alerts table with proper schema
   â€¢ Added sample data for testing
   â€¢ Set correct permissions for application user
   â€¢ Added indexes for performance


================================================================================
ðŸ”§ TROUBLESHOOTING
================================================================================

ISSUE: Alerts page still shows 500 error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SOLUTION:
pm2 logs stromwater-backend --lines 50 | grep -i "alert\|error"

Check if alerts table exists:
sudo -u postgres psql -d stromwater_db -c "\dt alerts"


ISSUE: Analytics shows "reduce is not a function"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SOLUTION:
1. Hard refresh browser: Ctrl + Shift + R (clears cached JavaScript)
2. Verify frontend rebuilt:
   ls -lh /var/www/stromwater/frontend/dist/assets/*.js
   (Should show recent timestamp)
3. Restart frontend:
   pm2 restart stromwater-frontend


ISSUE: Analytics shows "No data available"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SOLUTION:
This is normal if no device_data exists. Check count:
sudo -u postgres psql -d stromwater_db -c "SELECT COUNT(*) FROM device_data;"

If count is 0 or very low, either:
â€¢ Run Step 2 to add test data, OR
â€¢ Run MQTT simulator from Windows for real data


ISSUE: "Failed to load alerts" toast message
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SOLUTION:
1. Check backend is running:
   pm2 status
2. Check backend logs:
   pm2 logs stromwater-backend --lines 30
3. Test API directly:
   curl http://localhost:5000/health
4. Restart backend:
   pm2 restart stromwater-backend


NUCLEAR OPTION: Restart Everything
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pm2 restart all
sudo systemctl restart nginx
sudo systemctl restart postgresql

pm2 status
sudo systemctl status nginx


================================================================================
ðŸ” DIAGNOSTIC COMMANDS
================================================================================

# List all database tables
sudo -u postgres psql -d stromwater_db -c "\dt"

# Check alerts data
sudo -u postgres psql -d stromwater_db -c "SELECT * FROM alerts ORDER BY timestamp DESC LIMIT 5;"

# Check device_data
sudo -u postgres psql -d stromwater_db -c "SELECT device_id, hydrostatic_value, timestamp FROM device_data ORDER BY timestamp DESC LIMIT 10;"

# Check PM2 processes
pm2 status
pm2 logs stromwater-backend --lines 50
pm2 logs stromwater-frontend --lines 50

# Check Nginx
sudo systemctl status nginx
sudo nginx -t

# Check PostgreSQL
sudo systemctl status postgresql
sudo -u postgres psql -d stromwater_db -c "SELECT version();"


================================================================================
âœ… SUCCESS CHECKLIST
================================================================================

Database Setup:
 â˜ alerts table exists (run: sudo -u postgres psql -d stromwater_db -c "\dt alerts")
 â˜ alerts table has 3+ records
 â˜ device_data has records (for Analytics)
 â˜ Permissions granted to stromwater_user

Code Deployment:
 â˜ Latest code pulled from GitHub
 â˜ Frontend rebuilt successfully
 â˜ Both PM2 services running (pm2 status)

Pages Working:
 â˜ Alerts page loads without errors
 â˜ Alerts page shows sample alerts
 â˜ Can acknowledge alerts
 â˜ Analytics page loads without errors
 â˜ Analytics shows statistics (if data exists)
 â˜ Navigation shows Analytics link
 â˜ No errors in browser console (F12)


================================================================================
ðŸ“ž NEED HELP?
================================================================================

If issues persist after following all steps, provide:

1. Backend logs:
   pm2 logs stromwater-backend --lines 100 > backend-logs.txt

2. Database check:
   sudo -u postgres psql -d stromwater_db << 'EOF' > db-check.txt
   \dt
   SELECT COUNT(*) FROM alerts;
   SELECT COUNT(*) FROM device_data;
   SELECT * FROM alerts LIMIT 3;
   EOF

3. PM2 status:
   pm2 status

4. Browser console errors:
   â€¢ Open browser (F12)
   â€¢ Go to Console tab
   â€¢ Copy any red errors

5. Frontend build output:
   cd /var/www/stromwater/frontend
   npm run build 2>&1 | tail -50


================================================================================
ðŸŽ‰ AFTER SUCCESSFUL DEPLOYMENT
================================================================================

Your StromWater IoT Dashboard now has:
âœ… Working Alerts page with alert management
âœ… Working Analytics page with device statistics
âœ… Robust error handling
âœ… Proper data validation
âœ… Better user experience

Next steps:
â€¢ Keep MQTT simulator running to collect real data
â€¢ Monitor alerts in real-time
â€¢ Use Analytics to track pump performance
â€¢ Add more devices as needed
